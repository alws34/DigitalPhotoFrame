<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Digital Photo Frame Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.mobile.css') }}" />
    <script defer src="{{ url_for('static', filename='scripts.js') }}"></script>
  </head>
  <body>
    <!-- Top Bar -->
    <header id="top-bar" class="top-bar" role="banner">
      <div class="top-left">
        <span class="welcome-message">Welcome {{ username }}!</span>
      </div>
      <div class="top-right">
        <button class="hamburger" id="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="dropdown-menu">&#9776;</button>
        <nav id="dropdown-menu" class="dropdown-menu" aria-label="Main" hidden>
          <button id="btn-edit-images" class="menu-item" type="button">Edit Images</button>
          <button id="btn-app-settings" class="menu-item" type="button">Settings</button>
          <button id="btn-upload" class="menu-item" type="button">Upload</button>
          <button id="btn-logs" class="menu-item" type="button">Show Logs</button>
          <button id="btn-logout" class="menu-item" type="button">Logout</button>
        </nav>
      </div>
    </header>

    <main id="main-container" class="main" role="main">
      <section id="image-transition" class="frame">
        <img id="liveImage" src="/stream?width=1280&height=960" alt="Live frame image" />
      </section>

      <section id="image-info" class="meta">
        <div id="caption">Caption: <span id="captionField">Loading...</span></div>
        <div>Uploader: <span id="uploaderField">Loading...</span></div>
        <div>Date Added: <span id="dateField" data-format="datetime" data-formatted=""></span></div>
      </section>

      <!-- Gallery / Settings Drawer -->
      <section id="bottom-scrollable" class="drawer" hidden>
        <div class="action-bar">
          <button id="btn-download-selected">Download Selected</button>
          <button id="btn-delete-selected">Delete Selected</button>
          <button id="btn-close-settings" class="close-btn" aria-label="Close panel">x</button>
        </div>

        <div id="gallery" class="gallery">
          {% for image in images %}
          <article class="image-card" data-image="{{ image }}">
            <img
              src="{{ url_for('thumb', filename=image) }}?w=320"
              srcset="
                {{ url_for('thumb', filename=image) }}?w=240 240w,
                {{ url_for('thumb', filename=image) }}?w=320 320w,
                {{ url_for('thumb', filename=image) }}?w=480 480w,
                {{ url_for('thumb', filename=image) }}?w=640 640w"
              sizes="(max-width: 480px) 45vw, (max-width: 1024px) 30vw, 240px"
              alt="{{ image }}"
              loading="lazy"
              decoding="async"
              fetchpriority="low"
              width="240"
              height="160"
              data-full="{{ url_for('serve_image', filename=image) }}"
            />
            <label class="select-row">
              <input type="checkbox" class="select-checkbox" value="{{ image }}" />
              <span>Select</span>
            </label>
            <div class="row">
              <button class="btn-edit" data-image="{{ image }}" type="button">Edit</button>
            </div>
          </article>
          {% endfor %}
        </div>
      </section>
    </main>

    <!-- Logs Modal -->
    <dialog id="logsModal" class="modal" aria-labelledby="logs-title">
      <form method="dialog" class="modal-content">
        <h2 id="logs-title">Live Logs</h2>
        <textarea id="logText" readonly></textarea>
        <div class="modal-actions">
          <button type="button" id="btn-download-logs">Download Logs</button>
          <button type="button" id="btn-clear-logs">Clear Logs</button>
          <button id="logs-close">Close</button>
        </div>
      </form>
    </dialog>

    <!-- Edit Metadata Modal -->
    <dialog id="editModal" class="modal" aria-labelledby="edit-title">
      <form id="editForm" method="dialog" class="modal-content">
        <h2 id="edit-title">Edit Image Metadata</h2>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <input type="hidden" id="editImageName" name="imageName" />
        <div class="form-group">
          <label for="editCaption">Caption</label>
          <input type="text" id="editCaption" name="caption" />
        </div>
        <div class="form-group">
          <label for="editUploader">Uploader</label>
          <input type="text" id="editUploader" name="uploader" />
        </div>
        <div class="form-group">
          <label for="editDateAdded">Date Added</label>
          <input type="text" id="editDateAdded" name="date_added" readonly />
        </div>
        <div class="form-group">
          <label for="editHash">Image Hash</label>
          <input type="text" id="editHash" name="hash" readonly />
        </div>
        <div class="form-actions">
          <button type="submit" id="edit-save">Save</button>
          <button id="edit-cancel">Cancel</button>
        </div>
      </form>
    </dialog>

    <!-- Upload Modal -->
    <dialog id="uploadModal" class="modal" aria-labelledby="upload-title">
      <form id="uploadForm" method="dialog" class="modal-content" enctype="multipart/form-data">
        <h2 id="upload-title">Upload Images</h2>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div id="dropZone" role="button" tabindex="0" aria-label="Drag and drop images or press Enter to browse">
          <p>Drag & Drop Images Here or Click to Browse</p>
          <input type="file" id="fileInput" name="file[]" multiple accept="image/*" hidden />
          <button type="button" id="btn-browse">Browse</button>
        </div>
        <div id="previewContainer" class="previews"></div>
        <div class="form-actions">
          <button type="submit">Upload</button>
          <button id="upload-cancel">Cancel</button>
        </div>
      </form>
    </dialog>
  </body>
</html>
